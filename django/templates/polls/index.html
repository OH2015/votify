<!-- templates/index.html -->
{% extends 'base.html' %}
<!-- „Çø„Ç§„Éà„É´ -->
{% block title %}„Éà„ÉÉ„ÉóÁîªÈù¢{% endblock %}
<!-- ËøΩÂä†„É™„ÇΩ„Éº„Çπ -->
{% block extra-static %}
<!-- Vue3 -->
<script src="https://unpkg.com/vue@3"></script>
<!-- axios(APIÈùûÂêåÊúüÈÄö‰ø°) -->
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
{% endblock %}
<!-- Â≠ê„Éª„É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
{% block content %}

<div id="app">
    [[ message ]]
    <select v-model="genre" v-on:change="search" class="select-genre">
        <option value="">ÂÖ®„Å¶</option>
        {% for genre in genres %}
        <option value="{{ genre }}">{{ genre }}</option>
        {% endfor %}
    </select>
    <input v-on:keydown.enter="search" v-model="keyword" placeholder="Ê§úÁ¥¢„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ">
    <input type="button" v-on:click="search" class="search-btn" value="üîç">
    
    
    <div class="questions-header">
        [[ no_results ]]
        <div>
            <select id="select_sort" v-on:change="sort">
                <option value="0" selected>Èñ≤Ë¶ßÂõûÊï∞„ÅÆÂ§ö„ÅÑÈ†Ü</option>
            </select>
            <span class="reverse" v-on:click="reverse">‚Üë‚Üì</span>
        </div>
    </div>
    
    
    <div v-for="question in questions">
        <a v-bind:href="'vote/' + question.id + '/'" class="question">
            <p>[[ question.title ]]</p>
            
            <p class="watched">[[ question.author.username ]] [[ question.genre ]]   [[ question.watched ]]view</p>
        </a>
    </div>
    
</div>

<style>
    #app{
        max-width: 800px;
        margin: auto;
    }
    .select-genre{
        margin-right: 50px;
    }
    .questions-header{
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
        margin-bottom: 10px;
    }
    .reverse:hover{
        cursor: pointer;
    }
    .question{
        display: block;
        text-decoration: none;
        border: solid 1px gray;
        border-radius: 10px;
        padding: 5px;
        margin-bottom: 10px;
        
    }
    .question:hover{
        background-color: #CCFFFF;
    }
    .watched{
        font-size: 15px;
        text-align: right;
    }

</style>


<script>
    Vue.createApp({
        data() {
            return {
                message: '',
                keyword: "",
                genre: "",
                questions: [],
            }
        }
        ,methods: {
            search(){
                axios.get("/api/questions/",{
                    params:{
                        keyword: this.keyword,
                        genre: this.genre,
                    }
                })
                .then(res => {
                    this.questions = res.data
                    this.sort()
                })
                .catch(res => {
                    this.message = "Ê§úÁ¥¢„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"
                })
            },
            sort(){
                sort_idx = document.getElementById("select_sort").value;
                if(sort_idx == 0){
                    this.questions.sort((a,b) => {
                        if (a.watched > b.watched){
                            return -1;
                        }else if (a.watched < b.watched){
                            return 1;
                        }else{
                            return 0;
                        }
                    })
                }
            },
            reverse(){
                this.questions.reverse();
            }
        }
        ,mounted() {
            this.search();
        }
        ,computed:{
            no_results: function(){
                return 'Ê§úÁ¥¢ÁµêÊûú' + this.questions.length + '‰ª∂'
            }
        }
        // django„ÅÆ„ÉÜ„É≥„Éó„É¨„Éº„Éà„Ç®„É≥„Ç∏„É≥„Å®Á´∂Âêà„Åô„Çã„ÅÆ„Åß{}„Åã„Çâ[]„Å´Â§âÊõ¥
        ,delimiters: ['[[', ']]']
    }).mount('#app')
</script>
{% endblock %}