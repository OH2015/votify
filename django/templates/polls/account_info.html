<!-- templates/index.html -->
{% extends 'base.html' %}
<!-- タイトル -->
{% block title %}アカウント情報{% endblock %}
<!-- 追加リソース -->
{% block extra-static %}
<!-- axios(API非同期通信) -->
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
{% load static %} {% endblock %}
<!-- 子・メインコンテンツ -->
{% block content %}
<form id="form">
  <div class="container container-fluid">
    <div class="row">
      <label>ユーザ名</label>
      <input name="username" value="{{ user.username }}" />
    </div>
    <div class="row">
      <label>メールアドレス</label>
      <input name="email" value="{{ user.email }}" disabled />
    </div>
    <div class="row">
      <label>プロフィール</label>
      <textarea
        name="profile"
        maxlength="1000"
      >{{user.profile}}</textarea>
    </div>
    <div class="row">
        <input id="update" type="button" onclick="sendData()" value="更新" />
    </div>
  </div>
</form>

<style>
#form{
  max-width: 700px;
  margin: auto;
}
.row{
  margin-bottom: 10px;
}
#update{
  width: 100px;
}
</style>

<script>
  axios.defaults.xsrfCookieName = "csrftoken";
  axios.defaults.xsrfHeaderName = "X-CSRFTOKEN";
  function auto_grow(element) {
    element.style.height = "5px";
    element.style.height = element.scrollHeight + "px";
  }
  function sendData() {
    // formタグの要素を取得
    const form = document.getElementById("form");
    const formData = new FormData(form);
    axios
      .put("/api/user/{{user.id}}/", formData)
      .then((response) => {
        // レスポンス処理
        alert("アカウント情報を更新しました！")
      })
      .catch((error) => {
        // エラー処理
        console.log(error);
      });
  }
</script>

{% endblock %}
